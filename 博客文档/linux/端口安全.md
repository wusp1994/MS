

## 阿里云ip访问服务器centOS7通过解决



***<u>注意不要忘记，添加数据库端口 3306</u>***
这个是真的坑，
1，先要在安全规则配置你想访问的端口。
2，防火墙还不能关闭，要通过firewall可以启用其他端口的远程访问权限。
3，缺一条都不行。

通过浏览器访问服务器ip地址不能访问，关闭防火墙后，**发现防火墙已经关闭，但是我通过浏览器无法访问虚拟机的80和8080端口，查找资料发现centOS7的系统<u>即便是关闭防火墙，端口也是只开放22</u>，所以在关闭防火墙后，依然无法访问，找了诸多解决办法，最后找到了<u>通过firewall可以启用其他端口的远程访问权限</u>。**
查看阿里云论坛说是要在 <u>**控制台安全组规则**</u> 里添加安全组规则配置可以外网ip访问的端口，按照说明添加好了问题依然存在-外网还是不能访问此接口，最后发现是需要在 **<u>防火墙中开启这个监听的端口</u>**；

![Image](C:\Users\81219\Desktop\Image.png)

添加后需要在防火墙内添加端口监控，
<u>**并并并重启防火墙**</u>
<u>注意不要忘记，添加数据端口 3306</u>

```sh
#再次开启80远端访问
firewall-cmd --zone=public --add-port=9000/tcp --permanent
--zone #作用域
--add-port=80/tcp #添加端口，格式为：端口/通讯协议
--permanent #永久生效，没有此参数重启后失效

#添加后重启防火墙            
firewall-cmd --reload 

#打开防火墙，FirewallD is not running 防火墙关闭
systemctl start firewalld

#查看防火墙状态
systemctl status firewalld

#关闭防火墙
systemctl stop firewalld
#再次开启远端访问
firewall-cmd --permanent --zone=public --add-port=3306/tcp
```




如果以上都做了还是无法访问 nodejs 项目无法访问.
查看运行的 pm2 start /bin/www 的对不对，此为express项目运行命令
普通项目为 pm2 start app.js/server.js #服务js名称
接则向下看
 使用命令netstat -ntpl查看端口时发现node开启的端口是tcp6的，这可能就是外网无法访问的原因了

解决方法1
就是app.listen()方法显式填写ipv4的地址（我用的框架是koa，express也是相同的解决方法）。   
原来是这么写的：
>var app = new Koa();
>app.listen(5000);

  更改成下面就可以打开ipv4的端口了
>var app = new Koa();
>app.listen(5000, '0.0.0.0');

解决方法2 
关闭ipv6
 帖子地址 https://www.jianshu.com/p/225d040d0b66